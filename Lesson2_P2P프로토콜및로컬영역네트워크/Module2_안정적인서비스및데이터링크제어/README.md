# 1. TCP 안정적인 스트림 및 흐름 제어
***
### TCP ARQ Model
- TCP는 오류가 없고 중복이 없으며 발신자가 생성한 순서대로 안정적인 서비스를 제공함
- 선택적 반복 ARQ 프로토콜을 사용하며 몇 가지 측면이 다르다
- 한가지 차이점은 정보 사용이 일련의 블록으로 구성되지 않고 바이트 스트림으로 구성된다는 것
### TCP Reliable Stream Service
- TCP에서는 응용 프로그램 계층이 소켓을 통해 발신자 버퍼에 바이트를 기록하지만, 여러 바이트 간의 경계는 유지되지 않는다
- TCP는 스트림을 여러 개의 스트림으로 분할하거나 여러 개의 작은 바이트를 단일 바이트로 병합하기로 결정할 수 있다
### TCP ARQ Environment
- TCP는 자체적으로 연결 패킷 전송 서비스를 제공하는 IP 의 연결 지향 서비스를 제공하도록 설계됨
- IP 네트워크에서는 발신자와 수신자 간에 전송되는 각 패킷이 서로 다른 경로를 통과할 수 있으며
- 패킷이 오류 또는 손실된 상태로 도착하거나 순서가 맞지 않을 수 있다
- 매우 긴 지연 후에도 패킷 도착 가능
- 인터넷에서는 이전 연결의 오래된 세그먼트가 수신기에 도착할 수 있으므로 중복을 감지하고 제거하는 것이 더 복잡함
- 따라서 유선과 같은 환경에서 작동하는 일반 ARQ보다 더 복잡함
### TCP ARQ Sequence #
- Sequence Numbers
- TCP는 32비트의 긴 시퀀스 번호를 사용하고 연결 설정 중에 무작위로 선택된 초기 시퀀스 번호를 설정하여 이 문제를 해결함
- 수신은 언제든지 훨씬 작은 윈도우에서 시퀀싱된 번호를 받아들임
- 따라서 아주 오래된 메시지를 받아들일 가능성은 매우 낮음
### TCP Connections
- TCP는 3방향 Handshake를 사용하여 TCP 연결을 설정하고 초기 시퀀스 번호를 설정함
- 각 연결은 발신자 IP 주소, 발신자 TCP 포트 번호, 수신자 IP 주소 및 수신자 TCP 포트 번호로 고유하게 식별됨
### Wireshark
- 유용한 네트워크 프로토콜 분석 도구
- 네트워크에서 일어나는 일을 미세한 수준에서 볼 수 있음
- 패킷과 프로토콜에 대한 자세한 정보를 볼 수 있음
### Transmitter & Receiver
- TCP는 승인된 메시지와 타이머 메커니즘을 사용하여 일종의 선택적 반복 ARQ를 증가시키는 슬라이딩 윈도우 메커니즘을 사용함
- 발신자 창에는 4 개의 포인터가 있음 (ppt 참고, S last, S recent etc..)
- 수신자 창에도 4 개의 포인터가 있음 (R last, R next etc...)
### TCP Data Exchange
- TCP 데이터 교환에서 TCP 발신자는 연속된 바이트 문자열을 세그먼트로 정렬함
- 성능을 선택적으로 확인하려면 ARQ 함수를 반복
### TCP Sequence #
- 세그먼트에는 전송되는 문자열의 첫 번째 바이트 수에 해당하는 시퀀스 번호가 포함됨
- 기존 ARQ 프로토콜과는 매우 다름
### TCP Flow Control
- TCP는 흐름 제어 기능과 승인 기능을 분리함
- 흐름 제어 기능이 구현되어 두 번째 헤드의 윈도우 필드를 알림
- 알려진 윈도우 크기는 Wa = Wr - (R new - R last)
- 따라서 TCP 발신자는 미결제 바이트 수를 윈도우 크기인 Wa 미만으로 유지해야 함
### TCP Retransmission Timeout
- TCP에서 송신기는 세그먼트가 전송될 때마다 타이머를 설정함
- 타임아웃은 너무 길거나 짧을 수 없다
- 실제로 RTT에 따라 달라짐
- 유선과 같지 않게 인터넷에서는 RTT가 매우 가변적이다
### Adaptive RTT
- TCP는 RTT의 적응형 추정을 사용
- 승인이 수신될 떄마다 RTT를 지속적으로 측정함
### RTT Variability
- RTT 변동은 추정 RTT의 표준 편차로도 추정됨
- 타임아웃은 이 추정 RTT에 추정된 RTT 변동에 K를 곱한 값으로 설정됨
- 실제로는 편차를 대략적으로 추정해야 함
***
### 요약
- TCP 흐름 제어는 선택적 반복 ARQ를 기반으로 함, 몇 가지 주요 측면에서 차이가 있음
***
# 2. 프레이밍 및 PPP
***
### Data Link Protocols
- 데이터 링크는 wire-like
- 전송된 순서와 동일한 순서로 프레임이 도착한다
- 데이터 링크 제어는 프레임이 이 임펄스를 따르는 네트워크를 통한 연결뿐만 아니라, point-to-point 통신 회선에도 적용 가능
### 프레이밍
- 디지털 스트림 내 정보 블록의 시작과 끝을 식별하는 것을 포함
- 프레이밍은 물리 계층 비트 스트림을 프레임으로 매핑하고 맵 프레임을 비트 스트림으로 매핑함
- 프레임 길이가 가변적인 경우를 예
  - 프레임 경계는 프레임의 시작과 끝을 식별하는 특수 문자를 사용하여 결정할 수 있음
  - 플래그 - 특수 비트 패턴, 프레임의 시작과 끝 식별
  - CRC Checks
### Character-Oriented Framing (Byte Stuffing)
- 프레임 내 정보가 정수의 문자로 구성된 경우, 문자 기반 프레임 동기화 방법이 사용
- 문자 프레임을 구분하기 위해 인쇄 가능한 문자에 연결되지 않는 특수 8비트 코드가 제어 문자로 사용됨
- 이런 접근 방식을 바이트 스터핑이라고 함
- 16진수 값이 0인 데이터 링크 이스케이프 제어 특수 문자 **_DLE_** 도입
- 두 문자 시퀀스 DLE, STX는 프레임의 시작을 나타내는 데 사용되고
- DLE, ETX는 프레임의 끝을 나타냄
- 수신기는 이런 문자 쌍을 찾아 프레임의 시작과 끝을 식별함
- 프레임의 데이터 컨테이너에서 DLE STX ETX 쌍이 발생하는 문제를 처리함
- 그리고 프레임 내부에 DLE가 발생하기 전에 여분의 DLE를 삽입하거나 채움
- 데이터에 있는 모든 합법적인 DLE는 2개의 DLE로 대체됨
- 따라서 개별 DLE가 발생하는 유일한 경우는 프레임의 시작과 끝을 식별하는 STX 또는 ETX가 해당 STX나 ETX를 인식할 때 발생함
### Flag-based Framing & Bit Stuffing
- 플래그 기반 비트 스터핑 프레이밍은 프레임 내에서 임의의 수의 비트를 전송하기 위한 것
- HDLC에 사용됨
### Bit Stuffing
- 프레임은 16진수 7E의 플래그 문자로 표시됨
- 비트 스터핑을 사용하여 프레임 데이터로 내부에 플래그가 발생하는 것을 방지함
- 송신기가 프레임 안에 연속으로 5개씩 1이 들어가면 송신기는 추가적인 0을 삽입한다
- 수신기는 연속된 5개의 1이 있는지 확인함
- 다음 비트가 0이면 제거 
- 다음 두 비트가 10 이면, 플래그 감지
- 다음 두 비트가 11 이면, 프레임에 오류가 있는것
***
### PPP : Point-to-Point Protocol
- PPP 는 point-to-point 링크를 통해 IP 패킷을 캡슐화하기 위한 마스트헤드를 제공함
- 두 라우터를 연결하거나 전화선, 모뎀을 사용하여 개인용 컴퓨터를 인터넷 서비스 공급자에 연결하는 데이터 링크 제어로 사용할 수 있음
- PPP는 여러 네트워크 프로토콜을 동시에 지원하도록 설계됨
- 즉, PPP는 서로 다른 네트워크 계층 프로토콜에서 생성된 패킷을 전송할 수 있음
### PPP Frame
- PPP 프로토콜은 HDLC와 같은 프레임 형식을 사용
- point-to-point 링크에서 데이터그램을 캡슐화하는 데 동일한 플래그를 사용
- PPP 프레임은 정수 바이트로 구성되므로 비트 스터핑을 사용
- 2가지 문제가 있음
  - 바이트 삽입으로 인해 프레임 크기를 예측할 수 없음
  - 악의적인 사용자가 7D와 7E를 반전시켜 네트워크 대역폭을 부풀릴 수 있음
### Byte-Stuffing in PPP
- PPP는 문자 지향 HDLC
- 동일한 플래그 16진수 7E를 사용하며 16진수 7D의 이스케이프도 제어
- PPP는 많은 point-to-point 애플리케이션에서 사용함
- 이더넷과 같은 공유 링크를 통해 LCP, NCP 및 인증 기능을 제공하는 데 사용됨
- 링크 제어 프로토콜인 LCP는 링크 연결을 설정, 구성, 테스트, 유지 관리 및 종료하는 데 사용됨
### PPP Authentication
- PPP 인증은 암호 기반 프로토콜이지만 ID와 암호는 암호화되지 않은 상태로 전송되므로 도청되기 쉽다
- Challenge-Handshake Authentication Protocol (CHAP)
  - 개시자와 응답자가 채널 응답 시퀀스를 거치도록 하여 보안을 강화함
  - 순수 프로세스가 비밀 키를 공유한다고 가정함
  - AOCP가 링크를 설정한 후 인증자는 피어 프로세스에 챌린지를 보냄
  - 챌린지는 임의의 숫자와 ID로 구성됨
  - 피어 프로세스는 난수 값의 cryptographic 체크섬으로 응답함
  - 따라서 공유 암호를 사용함
  - 인증자는 공유 비밀 키를 사용하여 암호화 체크섬을 확인
  - 두 체크섬이 일치하면 인증자가 인증 메시지를 보냄
***
### 요약
- 비트, 바이트 스터핑은 프레이밍을 위해 사용됨
- PPP는 바이트 스터핑을 사용함
- CHAP는 보안 프로토콜임
***
# 3. HDLC, 멀티플렉싱
***
### High-Level Data Link Control (HDLC)
- PPP는 문자 지향 프로토콜이지만 HDLC는 비트 지향 프로토콜임
- HDLC는 비트 동기 물리 계층에서 데이터 링크를 운영하기 위한 다양한 표준을 제공함
- 이는 IBM SDLC에서 파생됨
- 데이터 링크 제어는 프레임을 전송하고 물리 계층에서 제공하는 비트 전송 서비스를 사용하는 네트워크 계층에 통신 서비스를 제공함
- 여러 유형의 서비스를 제공하도록 데이터 링크 계층을 구성할 수 있음
### HDLC Data Transfer Modes
- 두 가지 전송 모드가 있음
- Normal Response Mode (NRM)
  - 일반 응답 모드 : 멀티 드롭 라인을 폴링하는데 사용됨
- Asynchronous Balanced Mode (ABM)
  - 비동기 밸런스 모드 : full-duplex point-to-point 링크에 사용됨
### HDLC Frame Format
- 프로토콜의 기능은 헤더에 정의된 제어 필드에 따라 달라짐
- HDLC와 PPP는 프레이밍에 동일한 플래그 바이트를 사용함
- 프레임에는 항상 보조 주소의 주소를 포함하는 단 하나의 주소용 필드가 있고 기본 주소는 하나뿐임
### Control Field Format
- 제어 필드에는 3가지 유형 존재
- 제어 필드의 첫번째 비트가 0이면 정보 프레임
- 제어 필드의 처음 두 비트의 1-0은 감시 프레임을 식별
- 처음 두 비트에 있는 1-1은 번호가 지정되지 않은 프레임을 식별
- 이 프레임은 데이터 링크 제어, 오류 및 흐름 제어의 주요 기능을 구현함
### Error Detection & Loss Recovery
- 통신 시 동기화 손실이나 수신기 버퍼 오버플로우로 인해 프레임이 손실되었을 수 있음
- 프레임 전송 중에도 오류가 발생할 수 있음
- CRC는 손실된 것으로 처리되는 프레임에서 오류를 감지하는데 사용됨
- 복구는 승인, 타임아웃 및 재전송을 통해 이루어짐
- HDLC는 여러 ARQ 방법을 구현하는 옵션을 제공함
### Statistical Multiplexing
- 컴퓨터 애플리케이션은 전송을 위한 데이터를 버스트 방식으로 생성함
- 정보 폭증은 유휴 기간으로 구분되며 각 컴퓨터에 전용 전송 회선을 할당하는 것도 비효율적
- 이러한 동작으로 인해 디지털 전송선을 공유하기 위한 통계적 멀티플렉싱 기법이 개발됨
- 효율성 향상, 비용 절감
### Tradeoff Delay for Efficiency
- 세 터미널의 패킷을 멀티플렉싱해야 하는 경우를 예
- 파트 A는 각 터미널에 R bps의 속도로 자체 회선이 있었다면 패킷이 전송되었을 시간을 보여줌
- 파트 B는 세 흐름의 패킷을 멀티플렉서로 결합한 경우 패킷이 전송되는 시간을 보여줌
- 터미널은 버스트 방식으로 패킷을 생성하기 때문에 스트림을 단일 속도 회선인 R bps로 결합할 수 있음
- 따라서 상당한 효율성과 비용 절감을 달성할 수 있음
- 그러나 패킷 생성 시간이 겹치기 때문에 멀티플렉서는 일부 패킷을 버퍼링하고 지연시켜야 한다는 점에 유의
- 하지만 모든 패킷은 생성된 순서대로 전송됨
### Multiplexers inherent in Packet Switches
- 패킷 멀티플렉서는 두가지 상황에서 사용됨
- 첫 번째 단계에서는 패킷이 여러 회선을 통해 통계 멀티플렉서에 도착하여 원격 사이트로 전송
- 두 번재 패킷이 지정된 데이터 링크를 통해 전송하기 위해 패킷 스위치에 도착함
- 두 경우 모두 멀티플렉서는 패킷을 버퍼링하거나 대기열이라는 버퍼에 정렬함
- 멀티플렉싱은 이러한 대기열에서 발생함
- 일반적으로 패킷은 선입선출 방식으로 전송됨
- 그러나 스케쥴링의 우선 순위를 사용하여 순서나 패킷 전송을 결정하는 멀티플렉서가 점점 늘어나고 있다
- 대기열에서 패킷이 버퍼링된다
### Delay and Utilization Tradeoff
- 패킷이 전송되기 전에 대기하고 지연될 수 있음
- 따라서 멀티플렉서는 패킷 지연과 전송 회선 사용률의 균형을 이루도록 작동함
- 버퍼가 오버플로우되면 패킷이 손실될 수 있음
- 복구 작업은 종단 간 프로토콜이 담당한다
### Multiplexer Modeling
- 패킷 도착 패턴, 패킷 서비스 시간, 버퍼 Discipline이 중요
- 성능 측정값은 평균 지연 분포, 패킷 손실 확률, 회선 사용률
### Delay = Waiting + Service Times
- 지연은 큐 대기 시간에 패킷 서비스 시간을 더한 값
### Fluctuations in Packets in the System
- 통계 멀티플렉서의 동작은 지정된 시간에 멀티플렉서에 있는 패킷 수로 특징지어짐
### Poisson Arrivals & Queuing
- 푸아송 도착
- 패킷이 연속적으로 도착하기까지의 시간이 지수 랜덤 변수
- 대기 이론은 지연 및 손실 통계를 측정하는 데 매우 중요함
- 정교한 모니터링 및 분석이 필요함
***
### 요약
- 전반적으로 멀티플렉싱은 지연과 사용률을 적절히 절충할 수 있음